{"version":3,"file":"flowGraphMatrixBlocks.js","sourceRoot":"","sources":["../../../../../../../dev/core/src/FlowGraph/Blocks/Data/Math/flowGraphMatrixBlocks.ts"],"names":[],"mappings":"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","sourcesContent":["import { Matrix, Quaternion, TmpVectors, Vector3 } from \"../../../../Maths/math.vector\";\r\nimport { FlowGraphBinaryOperationBlock } from \"../flowGraphBinaryOperationBlock\";\r\nimport { RichTypeAny, RichTypeMatrix, RichTypeNumber, RichTypeQuaternion, RichTypeVector3 } from \"../../../flowGraphRichTypes\";\r\nimport { FlowGraphUnaryOperationBlock } from \"../flowGraphUnaryOperationBlock\";\r\nimport { FlowGraphBlock } from \"../../../flowGraphBlock\";\r\nimport type { FlowGraphDataConnection } from \"../../../flowGraphDataConnection\";\r\nimport type { FlowGraphContext } from \"../../../flowGraphContext\";\r\nimport type { TransformNode } from \"../../../../Meshes/transformNode\";\r\n\r\n/**\r\n * Adds two matrices together.\r\n * @experimental\r\n */\r\nexport class FlowGraphAddMatrixBlock extends FlowGraphBinaryOperationBlock<Matrix, Matrix, Matrix> {\r\n    constructor() {\r\n        super(RichTypeMatrix, RichTypeMatrix, RichTypeMatrix, (left, right) => left.add(right));\r\n    }\r\n}\r\n\r\n/**\r\n * Adds a matrix and a number together.\r\n * @experimental\r\n */\r\nexport class FlowGraphAddMatrixAndNumberBlock extends FlowGraphBinaryOperationBlock<Matrix, number, Matrix> {\r\n    private _cachedArray: Float32Array = new Float32Array(16);\r\n    private _cachedMatrix: Matrix = Matrix.Zero();\r\n    constructor() {\r\n        super(RichTypeMatrix, RichTypeNumber, RichTypeMatrix, (left, right) => {\r\n            for (let i = 0; i < left.m.length; i++) {\r\n                this._cachedArray[i] = left.m[i] + right;\r\n            }\r\n            return Matrix.FromArrayToRef(this._cachedArray, 0, this._cachedMatrix);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Subtracts two matrices.\r\n * @experimental\r\n */\r\nexport class FlowGraphSubtractMatrixBlock extends FlowGraphBinaryOperationBlock<Matrix, Matrix, Matrix> {\r\n    private _cachedMatrix: Matrix = Matrix.Zero();\r\n    constructor() {\r\n        super(RichTypeMatrix, RichTypeMatrix, RichTypeMatrix, (left, right) => left.addToRef(right.scaleToRef(-1, TmpVectors.Matrix[0]), this._cachedMatrix));\r\n    }\r\n}\r\n\r\n/**\r\n * Subtracts a matrix and a number together.\r\n * @experimental\r\n */\r\nexport class FlowGraphSubtractMatrixAndNumberBlock extends FlowGraphBinaryOperationBlock<Matrix, number, Matrix> {\r\n    private _cachedArray: Float32Array = new Float32Array(16);\r\n    private _cachedMatrix: Matrix = Matrix.Zero();\r\n    constructor() {\r\n        super(RichTypeMatrix, RichTypeNumber, RichTypeMatrix, (left, right) => {\r\n            for (let i = 0; i < left.m.length; i++) {\r\n                this._cachedArray[i] = left.m[i] - right;\r\n            }\r\n            return Matrix.FromArrayToRef(this._cachedArray, 0, this._cachedMatrix);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Multiplies two matrices together.\r\n * @experimental\r\n */\r\nexport class FlowGraphMultiplyMatrixBlock extends FlowGraphBinaryOperationBlock<Matrix, Matrix, Matrix> {\r\n    private _cachedMatrix: Matrix = Matrix.Zero();\r\n    constructor() {\r\n        super(RichTypeMatrix, RichTypeMatrix, RichTypeMatrix, (left, right) => left.multiplyToRef(right, this._cachedMatrix));\r\n    }\r\n}\r\n\r\n/**\r\n * Divides two matrices.\r\n * @experimental\r\n */\r\nexport class FlowGraphDivideMatrixBlock extends FlowGraphBinaryOperationBlock<Matrix, Matrix, Matrix> {\r\n    private _cachedResultMatrix: Matrix = Matrix.Zero();\r\n    constructor() {\r\n        super(RichTypeMatrix, RichTypeMatrix, RichTypeMatrix, (left, right) => left.multiplyToRef(right.invertToRef(TmpVectors.Matrix[0]), this._cachedResultMatrix));\r\n    }\r\n}\r\n\r\n/**\r\n * Divides a matrix and a number together.\r\n * @experimental\r\n */\r\nexport class FlowGraphDivideMatrixAndNumberBlock extends FlowGraphBinaryOperationBlock<Matrix, number, Matrix> {\r\n    private _cachedArray: Float32Array = new Float32Array(16);\r\n    private _cachedMatrix: Matrix = Matrix.Zero();\r\n    constructor() {\r\n        super(RichTypeMatrix, RichTypeNumber, RichTypeMatrix, (left, right) => {\r\n            for (let i = 0; i < left.m.length; i++) {\r\n                this._cachedArray[i] = left.m[i] / right;\r\n            }\r\n            return Matrix.FromArrayToRef(this._cachedArray, 0, this._cachedMatrix);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Scales a matrix by a number.\r\n * @experimental\r\n */\r\nexport class FlowGraphScaleMatrixBlock extends FlowGraphBinaryOperationBlock<Matrix, number, Matrix> {\r\n    private _cachedMatrix = Matrix.Zero();\r\n    constructor() {\r\n        super(RichTypeMatrix, RichTypeNumber, RichTypeMatrix, (left, right) => left.scaleToRef(right, this._cachedMatrix));\r\n    }\r\n}\r\n\r\n/**\r\n * Clamps each value in a matrix between a minimum and maximum value.\r\n * @experimental\r\n */\r\nexport class FlowGraphClampMatrixBlock extends FlowGraphBlock {\r\n    /**\r\n     * Input connection: The matrix to clamp.\r\n     */\r\n    public readonly input: FlowGraphDataConnection<Matrix>;\r\n    /**\r\n     * Output connection: The clamped matrix.\r\n     */\r\n    public readonly output: FlowGraphDataConnection<Matrix>;\r\n    /**\r\n     * Input connection: The minimum value.\r\n     */\r\n    public readonly min: FlowGraphDataConnection<number>;\r\n    /**\r\n     * Input connection: The maximum value.\r\n     */\r\n    public readonly max: FlowGraphDataConnection<number>;\r\n    private _cachedArray: Float32Array = new Float32Array(16);\r\n    private _cachedMatrix: Matrix = Matrix.Identity();\r\n    constructor() {\r\n        super();\r\n\r\n        this.input = this._registerDataInput(\"input\", RichTypeMatrix);\r\n        this.min = this._registerDataInput(\"min\", RichTypeNumber);\r\n        this.max = this._registerDataInput(\"max\", RichTypeNumber);\r\n        this.output = this._registerDataOutput(\"output\", RichTypeMatrix);\r\n    }\r\n\r\n    public _updateOutputs(_context: FlowGraphContext): void {\r\n        const input = this.input.getValue(_context);\r\n        const min = this.min.getValue(_context);\r\n        const max = this.max.getValue(_context);\r\n\r\n        for (let i = 0; i < input.m.length; i++) {\r\n            this._cachedArray[i] = Math.min(Math.max(input.m[i], min), max);\r\n        }\r\n\r\n        Matrix.FromArrayToRef(this._cachedArray, 0, this._cachedMatrix);\r\n        this.output.setValue(this._cachedMatrix, _context);\r\n    }\r\n}\r\n\r\n/**\r\n * Decomposes a matrix into its translation, rotation and scale components.\r\n * @experimental\r\n */\r\nexport class FlowGraphDecomposeMatrixBlock extends FlowGraphBlock {\r\n    /**\r\n     * Input connection: The matrix to decompose.\r\n     */\r\n    public readonly input: FlowGraphDataConnection<Matrix>;\r\n    /**\r\n     * Output connection: The translation component of the matrix.\r\n     */\r\n    public readonly translation: FlowGraphDataConnection<Vector3>;\r\n    /**\r\n     * Output connection: The rotation component of the matrix.\r\n     */\r\n    public readonly rotation: FlowGraphDataConnection<Quaternion>;\r\n    /**\r\n     * Output connection: The scale component of the matrix.\r\n     */\r\n    public readonly scale: FlowGraphDataConnection<Vector3>;\r\n\r\n    private _cachedTranslation = new Vector3();\r\n    private _cachedRotation = new Quaternion();\r\n    private _cachedScale = new Vector3();\r\n\r\n    public constructor() {\r\n        super();\r\n\r\n        this.input = this._registerDataInput(\"input\", RichTypeMatrix);\r\n        this.translation = this._registerDataOutput(\"translation\", RichTypeVector3);\r\n        this.rotation = this._registerDataOutput(\"rotation\", RichTypeQuaternion);\r\n        this.scale = this._registerDataOutput(\"scale\", RichTypeVector3);\r\n    }\r\n\r\n    public _updateOutputs(_context: FlowGraphContext): void {\r\n        const input = this.input.getValue(_context);\r\n\r\n        input.decompose(this._cachedScale, this._cachedRotation, this._cachedTranslation);\r\n\r\n        this.translation.setValue(this._cachedTranslation, _context);\r\n        this.rotation.setValue(this._cachedRotation, _context);\r\n        this.scale.setValue(this._cachedScale, _context);\r\n    }\r\n}\r\n\r\n/**\r\n * Decomposes a matrix into its translation, rotation and scale components.\r\n * @experimental\r\n */\r\nexport class FlowGraphComposeMatrixBlock extends FlowGraphBlock {\r\n    /**\r\n     * Output connection: The matrix to compose.\r\n     */\r\n    public readonly output: FlowGraphDataConnection<Matrix>;\r\n    /**\r\n     * Input connection: The translation component of the matrix.\r\n     */\r\n    public readonly translation: FlowGraphDataConnection<Vector3>;\r\n    /**\r\n     * Input connection: The rotation component of the matrix.\r\n     */\r\n    public readonly rotation: FlowGraphDataConnection<Quaternion>;\r\n    /**\r\n     * Input connection: The scale component of the matrix.\r\n     */\r\n    public readonly scale: FlowGraphDataConnection<Vector3>;\r\n\r\n    private _cachedMatrix = new Matrix();\r\n\r\n    public constructor() {\r\n        super();\r\n\r\n        this.output = this._registerDataOutput(\"input\", RichTypeMatrix);\r\n        this.translation = this._registerDataInput(\"translation\", RichTypeVector3);\r\n        this.rotation = this._registerDataInput(\"rotation\", RichTypeQuaternion);\r\n        this.scale = this._registerDataInput(\"scale\", RichTypeVector3);\r\n    }\r\n\r\n    public _updateOutputs(_context: FlowGraphContext): void {\r\n        const translation = this.translation.getValue(_context);\r\n        const rotation = this.rotation.getValue(_context);\r\n        const scale = this.scale.getValue(_context);\r\n\r\n        Matrix.ComposeToRef(scale, rotation, translation, this._cachedMatrix);\r\n\r\n        this.output.setValue(this._cachedMatrix, _context);\r\n    }\r\n}\r\n\r\n/**\r\n * Converts a quaternion to a rotation matrix.\r\n * @experimental\r\n */\r\nexport class FlowGraphQuaternionToRotationMatrixBlock extends FlowGraphUnaryOperationBlock<Quaternion, Matrix> {\r\n    private _cachedMatrix = new Matrix();\r\n    constructor() {\r\n        super(RichTypeQuaternion, RichTypeMatrix, (value) => Matrix.FromQuaternionToRef(value, this._cachedMatrix));\r\n    }\r\n}\r\n\r\n/**\r\n * Given the Transform Nodes A and B, gives the matrix required\r\n * to transform coordinates from A's local space to B's local space.\r\n */\r\nexport class FlowGraphGetTransformationMatrixBlock extends FlowGraphBinaryOperationBlock<TransformNode, TransformNode, Matrix> {\r\n    private _cachedResult: Matrix = Matrix.Zero();\r\n    constructor() {\r\n        super(RichTypeAny, RichTypeAny, RichTypeMatrix, (left: TransformNode, right: TransformNode) => {\r\n            const aMatrix = left.getWorldMatrix();\r\n            const bMatrix = right.getWorldMatrix();\r\n\r\n            const inverseB = bMatrix.invertToRef(TmpVectors.Matrix[0]);\r\n            const result = inverseB.multiplyToRef(aMatrix, this._cachedResult);\r\n            return result;\r\n        });\r\n    }\r\n}\r\n"]}